"use strict";(self.webpackChunkdora_rs_github_io=self.webpackChunkdora_rs_github_io||[]).push([[6313],{62952:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>d,toc:()=>s});var r=t(74848),o=t(28453);const c={},a="CUDA \u96f6\u62f7\u8d1d IPC",d={id:"guides/Development/Cuda",title:"CUDA \u96f6\u62f7\u8d1d IPC",description:"\u9996\u5148\u5047\u8bbe\u60a8\u5728 cuda \u4e0a\u6709\u4e00\u4e2a pytorch tensor\uff0c\u5e76\u4e14\u60a8\u5e0c\u671b\u5728\u8282\u70b9\u4e4b\u95f4\u5171\u4eab\u5b83\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guides/Development/Cuda.md",sourceDirName:"guides/Development",slug:"/guides/Development/Cuda",permalink:"/zh-CN/docs/guides/Development/Cuda",draft:!1,unlisted:!1,editUrl:"https://crowdin.com/dora-rs/zh-CN",tags:[],version:"current",frontMatter:{},sidebar:"guides",previous:{title:"Arrow",permalink:"/zh-CN/docs/guides/Development/Arrow"},next:{title:"\u52a8\u6001\u7ed3\u70b9",permalink:"/zh-CN/docs/guides/Development/dynamic-node"}},i={},s=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u53d1\u9001\u6570\u636e",id:"\u53d1\u9001\u6570\u636e",level:2},{value:"\u63a5\u6536\u6570\u636e",id:"\u63a5\u6536\u6570\u636e",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"cuda-\u96f6\u62f7\u8d1d-ipc",children:"CUDA \u96f6\u62f7\u8d1d IPC"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\u5047\u8bbe\u60a8\u5728 cuda \u4e0a\u6709\u4e00\u4e2a pytorch tensor\uff0c\u5e76\u4e14\u60a8\u5e0c\u671b\u5728\u8282\u70b9\u4e4b\u95f4\u5171\u4eab\u5b83\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u597d\u6d88\u606f\u662f\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 CUDA \u96f6\u62f7\u8d1d IPC \u5728\u4e0d\u590d\u5236\u6570\u636e\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\u6b64\u64cd\u4f5c\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528\u6b64\u7279\u6027\uff0c\u786e\u4fdd\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'\n# \u5b89\u88c5\u5177\u6709 Gpu \u652f\u6301\u7684 pyarrow\nconda install pyarrow "arrow-cpp-proc=*=cuda" -c conda-forge\n\n## \u4f7f\u7528\u5982\u4e0b\u6d4b\u8bd5\u5b89\u88c5\npython -c "import pyarrow.cuda"\n\n# \u5b89\u88c5\u4ece arrow \u81f3 torchl \u8f6c\u8bd1\u7684 numba\npip install numba\n\n## \u4f7f\u7528\u5982\u4e0b\u6d4b\u8bd5\u5b89\u88c5\npython -c "import numba.cuda"\n\n# \u5982\u679c torch \u4e0d\u5b58\u5728\u8bf7\u5148\u5b89\u88c5\npip install torch\n\n## \u4f7f\u7528\u5982\u4e0b\u6d4b\u8bd5\u5b89\u88c5\npython -c "import torch; assert torch.cuda.is_available()"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53d1\u9001\u6570\u636e",children:"\u53d1\u9001\u6570\u636e"}),"\n",(0,r.jsx)(n.p,{children:"\u521b\u5efa\u5728\u8fdb\u7a0b\u95f4\u53d1\u9001\u7684 IPC \u53e5\u67c4\uff0c\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import torch\nfrom dora.cuda import torch_to_ipc_buffer\n\ntorch_tensor = torch.tensor([1, 2, 3], dtype=torch.int64, device="cuda")\nipc_buffer, metadata = torch_to_ipc_buffer(torch_tensor)\nnode.send_output("latency", ipc_buffer, metadata)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u63a5\u6536\u6570\u636e",children:"\u63a5\u6536\u6570\u636e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pyarrow as pa\nfrom dora import Node\nfrom dora.cuda import ipc_buffer_to_ipc_handle, cudabuffer_to_torch\n\nctx = pa.cuda.context()\nnode = Node()\nevent = node.next() # \u83b7\u53d6\u4e00\u4e2a\u5e26\u6709\u4e00\u4e2a torch \u53e5\u67c4\u7684\u4e8b\u4ef6\n\nipc_handle = ipc_buffer_to_ipc_handle(event["value"])\ncudabuffer = ctx.open_ipc_buffer(ipc_handle)\ntorch_tensor = cudabuffer_to_torch(cudabuffer, event["metadata"])  # \u5728 cuda\n'})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>d});var r=t(96540);const o={},c=r.createContext(o);function a(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(c.Provider,{value:n},e.children)}}}]);