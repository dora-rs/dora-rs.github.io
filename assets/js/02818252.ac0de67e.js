"use strict";(self.webpackChunkdora_rs_github_io=self.webpackChunkdora_rs_github_io||[]).push([[8303],{2070:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var t=n(4848),s=n(8453);const a={sidebar_position:3},i="Obstacle location",r={id:"guides/dora-drives/obstacle_location",title:"Obstacle location",description:"The carla simulator gives us the possibility to work with many more sensors than just a camera feed. We can emulate an LIDAR, IMU, Depth sensor, Segmentation sensor...",source:"@site/docs/guides/dora-drives/obstacle_location.mdx",sourceDirName:"guides/dora-drives",slug:"/guides/dora-drives/obstacle_location",permalink:"/docs/guides/dora-drives/obstacle_location",draft:!1,unlisted:!1,editUrl:"https://github.com/dora-rs/dora-rs.github.io/edit/main/docs/guides/dora-drives/obstacle_location.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"guides",previous:{title:"Carla Simulator",permalink:"/docs/guides/dora-drives/carla"},next:{title:"Planning",permalink:"/docs/guides/dora-drives/planning"}},c={},l=[];function d(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.h1,{id:"obstacle-location",children:"Obstacle location"}),"\n",(0,t.jsx)(o.p,{children:"The carla simulator gives us the possibility to work with many more sensors than just a camera feed. We can emulate an LIDAR, IMU, Depth sensor, Segmentation sensor..."}),"\n",(0,t.jsxs)(o.p,{children:["Let's use the LIDAR sensor to locate the exact position of the obstacle that has been located by ",(0,t.jsx)(o.code,{children:"yolov5"}),"."]}),"\n",(0,t.jsxs)(o.blockquote,{children:["\n",(0,t.jsxs)(o.p,{children:["The lidar point cloud is an array of ",(0,t.jsx)(o.code,{children:"x, y, z, intensity"})," points."]}),"\n",(0,t.jsx)(o.p,{children:"The coordinates are based on Unreal Engine coordinate system which is:"}),"\n",(0,t.jsxs)(o.ul,{children:["\n",(0,t.jsx)(o.li,{children:"z is up"}),"\n",(0,t.jsx)(o.li,{children:"x is forward"}),"\n",(0,t.jsx)(o.li,{children:"y is right"}),"\n"]}),"\n",(0,t.jsxs)(o.p,{children:["More info: ",(0,t.jsx)(o.a,{href:"https://www.techarthub.com/a-practical-guide-to-unreal-engine-4s-coordinate-system/",children:"https://www.techarthub.com/a-practical-guide-to-unreal-engine-4s-coordinate-system/"})]}),"\n",(0,t.jsxs)(o.p,{children:["and within carla documentation: ",(0,t.jsx)(o.a,{href:"https://carla.readthedocs.io/en/latest/ref_sensors/#lidar-sensor",children:"https://carla.readthedocs.io/en/latest/ref_sensors/#lidar-sensor"})]}),"\n",(0,t.jsxs)(o.p,{children:["You can also check velodyne reference: ",(0,t.jsx)(o.a,{href:"https://github.com/ros-drivers/velodyne/blob/master/velodyne_pcl/README.md",children:"https://github.com/ros-drivers/velodyne/blob/master/velodyne_pcl/README.md"})]}),"\n"]}),"\n",(0,t.jsxs)(o.p,{children:["To get the obstacle location, we are going to compute the angle of every points in the point cloud. We can then map the angle of each pixel of the bounding box to a real point and therefore infere its location. We then transform the coordinate from the relative lIDAR coordinate system into a global coordinate system by adding the current position of the LIDAR sensor. The code can be found here: ",(0,t.jsx)(o.a,{href:"https://github.com/dora-rs/dora-drives/blob/main/operators/obstacle_location_op.py",children:(0,t.jsx)(o.code,{children:"operators/obstacle_location_op.py"})}),"."]}),"\n",(0,t.jsx)(o.p,{children:"To use the obstacle location, just add it to the graph with:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-yaml",children:"nodes:\n  - id: oasis_agent\n    custom:\n      inputs:\n        tick: dora/timer/millis/400\n      outputs:\n        - position\n        - speed\n        - image\n        - objective_waypoints\n        - lidar_pc\n        - opendrive\n      source: shell\n      # With Carla_source_node\n      args: python3 ../../carla/carla_source_node.py\n      #\n      # Or with the OASIS AGENT\n      #\n      # args: >\n        # python3 $SIMULATE --output \n        # --oasJson --criteriaConfig $CRITERIA\n        # --openscenario $XOSC\n        # --agent $TEAM_AGENT\n        # --agentConfig $TEAM_AGENT_CONF\n        # --destination $DESTINATION\n  \n  - id: yolov5\n    operator: \n      outputs:\n        - bbox\n      inputs:\n        image: oasis_agent/image\n      python: ../../operators/yolov5_op.py\n\n  - id: obstacle_location_op\n    operator: \n      outputs:\n        - obstacles\n      inputs:\n        lidar_pc: oasis_agent/lidar_pc\n        obstacles_bbox: yolov5/bbox\n        position: oasis_agent/position\n      python: ../../operators/obstacle_location_op.py\n\n  - id: plot\n    operator:\n      python: ../../operators/plot.py\n      inputs:\n        image: oasis_agent/image\n        obstacles_bbox: yolov5/bbox\n        position: oasis_agent/position\n        obstacles: obstacle_location_op/obstacles\n"})}),"\n",(0,t.jsx)(o.p,{children:"To run:"}),"\n",(0,t.jsx)(o.pre,{children:(0,t.jsx)(o.code,{className:"language-bash",children:"dora up\ndora start graphs/oasis/oasis_agent_obstacle_location.yaml --attach\n"})}),"\n",(0,t.jsx)(o.p,{children:"You should be able to see a dot within the bounding box representing the estimated location in global coordinate of the obstacle."}),"\n",(0,t.jsx)("p",{align:"center",children:(0,t.jsx)("img",{src:"/img/obstacle_location.png",width:"800"})}),"\n",(0,t.jsxs)(o.blockquote,{children:["\n",(0,t.jsxs)(o.p,{children:["For more information on ",(0,t.jsx)(o.code,{children:"obstacle_location"}),", go on ",(0,t.jsxs)(o.a,{href:"/docs/nodes_operators/obstacle_location_op",children:["our ",(0,t.jsx)(o.code,{children:"obstacle_location"})," detail page"]})]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,t.jsx)(o,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>r});var t=n(6540);const s={},a=t.createContext(s);function i(e){const o=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),t.createElement(a.Provider,{value:o},e.children)}}}]);